<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Ranking â€“ Fotowettbewerb</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 60px; }
        .image-box {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .image-box img { width: 100%; height: auto; border-radius: 6px; }
        .vote-count { font-weight: bold; color: #198754; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="mb-4">ğŸ“Š Aktuelles Ranking</h1>
    <p><strong>ğŸ‘¥ WÃ¤hler:innen:</strong> {{ voters }} | <strong>ğŸ—³ï¸ Gesamtstimmen:</strong> {{ total_votes }}</p>

    <div class="row">
      {% for image in top_images %}
      <div class="col-12 col-sm-6 col-md-4">
          <div class="image-box">
              <img src="{{ url_for('main.media_year', year=image.contest_year, filename=image.filename) }}" alt="Bild">
              {% if image.uploader %}<p class="text-muted small mt-2"><strong>{{ image.uploader }}</strong></p>{% endif %}
              {% if image.description %}<p>{{ image.description }}</p>{% endif %}
              <p class="vote-count">âœ… Stimmen: {{ image.vote_count }} Â· Chips: {{ image.vote_points or 0 }}</p>
              <p class="small mb-1">ğŸ Score: {{ image.weighted_score or 0 }}</p>
              <p class="small text-muted">ğŸš€ {{ image.hype_count or 0 }} Â· ğŸ¨ {{ image.creative_count or 0 }} Â· ğŸ˜‚ {{ image.funny_count or 0 }} Â· ğŸ’ {{ image.underrated_count or 0 }}</p>
          </div>
      </div>
      {% endfor %}
    </div>

    <div class="d-flex justify-content-between align-items-center mt-4 flex-wrap gap-2">
        <a href="{{ url_for('main.upload') }}" class="btn btn-secondary">ğŸ”™ ZurÃ¼ck zum Adminbereich</a>
        <a href="{{ url_for('main.public_results') }}" target="_blank" class="btn btn-outline-primary ms-2">ğŸŒ Ã–ffentliches Ranking</a>
        <form method="POST" action="{{ url_for('main.toggle_publish') }}">
            {% if published %}
                <button type="submit" name="action" value="hide" class="btn btn-warning">ğŸ”’ VerÃ¶ffentlichung zurÃ¼cknehmen</button>
            {% else %}
                <button type="submit" name="action" value="show" class="btn btn-success">ğŸš€ Ergebnisse verÃ¶ffentlichen</button>
            {% endif %}
        </form>
    </div>

    <div class="card mt-3 border-danger-subtle">
        <div class="card-body d-flex flex-wrap gap-2 align-items-center justify-content-between">
            <div>
                <div class="fw-semibold text-danger">Stimmen/Chips zurÃ¼cksetzen</div>
                <div class="small text-muted">LÃ¶scht Votes + Chip-Werte + Kategorien/Reactions + Duell-Votes fÃ¼r das gewÃ¤hlte Jahr.</div>
            </div>
            <form method="POST" action="{{ url_for('main.reset_year_votes_admin') }}" class="d-flex gap-2 align-items-center" onsubmit="return confirm('Wirklich alle Stimmen/Chips fÃ¼r dieses Jahr lÃ¶schen?');">
                <select name="year" class="form-select form-select-sm" style="min-width: 120px;">
                    {% for y in available_years %}
                    <option value="{{ y }}" {% if y == current_year %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-outline-danger btn-sm">Reset Jahr</button>
            </form>
        </div>
    </div>
</div>
</body>
</html>